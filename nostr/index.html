---
title: João Bordalo
layout: main
---

<script src="https://bundle.run/buffer@6.0.3"></script>
<script src="https://bundle.run/bech32@2.0.0"></script>
<script src="https://nostr-utils.pages.dev/js/jquery-3.6.2.min.js"></script>
<script src="https://nostr-utils.pages.dev/js/nostr-utils.js"></script>

<style>
  div.metainfo {
    border-bottom: 1px silver solid;
    border-top: 1px silver solid;
    color: silver;
    display: flex;
    justify-content: space-between;
    margin-bottom: 1rem;
    padding: 0;
  }
  div.metainfo p,
  div.metainfo time {
    font-size: 0.8rem;
    padding: 0.2rem 0;
    margin: 0;
  }
  section.user {
    display: flex;
    justify-content: space-between;
    & img {
      border-radius: 50%;
      height: 8rem;
      width: auto;
    }
    & > div {
      align-items: center;
      display: flex;
      justify-content: flex-end;
      & div:first-child p {
        font-weight: 700;
        padding-right: 1rem;
        text-align: right;
      }
      & p {
        margin-bottom: 0.21rem;
      }
    }
  }
</style>

<template id="user">
  <section class="user">
    <p></p>
    <div>
      <div>
        <p>name:</p>
        <p>nip05:</p>
        <p>lud16:</p>
        <p>website:</p>
      </div>
      <div>
        <p></p>
        <p></p>
        <p></p>
        <p></p>
      </div>
    </div>
  </section>
</template>

<template id="post">
  <section>
    <div class="metainfo">
      <time datetime="" class="timeago"></time>
      <p></p>
    </div>
    <p></p>
  </section>
</template>

<section id="nostr" tabindex="0" style="margin-top: 0">
  <div class="container" id="postsList">
    <h1 class="heading">
      <span>Nostr</span>
    </h1>
    <h2 class="lead">Last 7 days on Nostr</h2>
    <p id="loading">Loading...</p>
  </div>
</section>

<script>
  const relays = [
    'wss://relay.utxo.one',
    'wss://relay.bitcoinpark.com',
    'wss://relay.damus.io',
    'wss://nos.lol',
    'wss://relay.current.fyi',
    'wss://relay.damus.io',
    'wss://relay.nostr.bg',
  ]

  let pubkey =
    '62cef883863022a4f1d60d54857c9d729650702c9fe227b0988c0b6e36c4bcce'

  if (!window.location.search) {
    window.location.href = window.location.href + `?${pubkey}`
  } else {
    pubkey = window.location.search.substring(1)
    if (/^npub/.test(pubkey)) {
      pubkey = npub2hexa(pubkey)
      window.location.search = `?${pubkey}`
    }
  }

  const pretty = {
    date: (unix) => {
      return new Date(unix * 1000).toLocaleDateString('en-us', {
        weekday: 'long',
        year: 'numeric',
        month: 'short',
        day: 'numeric',
      })
    },
    html: (content) => {
      for (const match of content.match(/https:\/\/.*/g)) {
        content = content.replace(match, `<a href="${match}">${match}</a>`)
      }
      return content.replace(/\n/g, '<br />')
    },
    link: (id) => `<a href="http://njump.me/${id}">link</a>`,
  }

  // get user profile
  getEvents({ authors: [pubkey], kinds: [0] }).then((events) => {
    document.querySelector('#loading').remove()
    const mostRecent = events.reduce((prev, curr) =>
      curr.created_at > prev.created_at ? curr : prev
    )
    const user = JSON.parse(mostRecent.content)
    const npub = hexa2npub(pubkey)
    const clone = document.querySelector('#user').content.cloneNode(true)
    const p = clone.querySelectorAll('p')
    p[0].innerHTML = `<img src="${user.picture}">`
    p[5].innerHTML = `<a href="https://njump.me/${npub}">${user.name}</a>`
    p[6].innerHTML = `<a href="https://njump.me/${user.nip05}">${user.nip05}</a>`
    p[7].innerHTML = `${user.lud16} ⚡`
    p[8].innerHTML = `<a href="https://njump.me/${user.website}">${user.website}</a>`
    document.querySelector('#postsList').appendChild(clone)
  })

  // get events from relays
  const aWeekAgo = Math.floor(Date.now() / 1000 - 7 * 24 * 60 * 60)
  const filter = { authors: [pubkey], kinds: [1], since: aWeekAgo }
  getEvents(filter).then((data) => {
    if (data.length === 0) {
      const p = document.createElement('p')
      p.innerText = '<empty>'
      document.querySelector('#postsList').appendChild(p)
    }
    data
      .filter((n) => n.tags.length === 0) // no replies
      .map((note) => {
        const clone = document.querySelector('#post').content.cloneNode(true)
        const p = clone.querySelectorAll('p')
        const t = clone.querySelector('time')
        t.innerHTML = pretty.date(note.created_at)
        p[0].innerHTML = pretty.link(note.id)
        p[1].innerHTML = pretty.html(note.content)
        document.querySelector('#postsList').appendChild(clone)
      })
  })
</script>
